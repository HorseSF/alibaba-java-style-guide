# alibaba-java-style-guide
* [前言](README.md)
* [编程规约](c1/README.md)
    * [(一) 命名规约](c1/s1.md)
    * [(二) 常量定义](c1/s2.md)
    * [(三) 格式规约](c1/s3.md)
    * [(四) OOP规约](c1/s4.md)
    * [(五) 集合处理](c1/s5.md)
    * [(六) 并发处理](c1/s6.md)
    * [(七) 控制语句](c1/s7.md)
    * [(八) 注释规约](c1/s8.md)
    * [(九) 其他](c1/s9.md)
* [异常日志](c2/README.md)
    * [(一) 异常处理](c2/s1.md)
    * [(二) 日志处理](c2/s2.md)
* [MySQL规约](c3/README.md)
    * [(一) 建表规约](c3/s1.md)
    * [(二) 索引规约](c3/s2.md)
    * [(三) SQL规约](c3/s3.md)
    * [(四) ORM规约](c3/s4.md)
* [工程规约](c4/README.md)
    * [(一) 应用分层](c4/s1.md)
    * [(二) 二方库规约](c4/s2.md)
    * [(三) 服务器规约](c4/s3.md)
* [安全规约](c5/README.md)

#### ELB/Auto Scaling
##### Elastic Load Balancing（ELB）
ELB配下の負荷分散先リソースのことを「ターゲット」といい、一つのELB配下で管理されるターゲットの集合を「ターゲットグループ」といいます。ターゲットにはEC2などのインスタンスや、IPアドレス、Lambda関数が指定でき、それらをまとめたターゲットグループ単位に負荷分散を行います。なお、AZ障害時の影響を少なくするためにも、ターゲットはマルチAZ（複数のAZに配置する構成）にするのが一般的です。

##### ELBの種類
* Application Load Balancer（ALB）
  ALBはレイヤー7（アプリケーション層）で負荷分散を行います。ALBではHTTP、HTTPSをサポートしています。また、WebSocketや、同一インスタンス内の複数ポートへの負荷分散、ホストベースやパスベース、URLクエリ文字列でのルーティングに対応しています。
* * ALBが対応している主なルーティング
  * ホストベース
    ホストベースのルーティングとは、クライアントがリクエストした接続先URLのFQDNに従ってルーティングできる機能のことです。
  * パスベース
    パスベースのルーティングとは、クライアントがリクエストした接続先URLのパスに従ってルーティングできる機能のことです。
  * URLクエリ文字列
    URLクエリ文字列でのルーティングとは、クライアントがリクエストした接続先URLのクエリ文字列に従ってルーティングできる機能のことです。
* Network Load Balancer（NLB）
  NLBはレイヤー4（トランスポート層）で負荷分散を行います。NLBではTCP、UDP、TLSをサポートしています。また、WebSocketや、同一インスタンス内の複数ポートへの負荷分散に対応しています。
* Classic Load Balancer（CLB）
  CLBはレイヤー7（アプリケーション層）およびレイヤー4（トランスポート層）で負荷分散を行います。CLBではHTTP、HTTPS、TCP、SSL/TLSをサポートしています。CLBはALBやNLBより古いサービスでパフォーマンスが劣るため、基本的にはALBやNLBの利用が推奨されています。

##### ELBの機能
* ヘルスチェック
* アクセスログ
  ELBに送信されるリクエストを記録しログをAmazon S3に保存します。記録されたログはトラフィックの分析やコンプライアンスの監査に利用できます。アクセスログには、クライアントのアクセス日時、接続元IPアドレス、ポート番号、ステータスコードなどクライアントの接続情報が記録されます。
* ELB自身のスケーリング
  ELBにはリクエスト数の増減に応じてELB自身が自動的にスケーリングする機能があります。リクエスト数が増加したらELB自身を自動的にスケールアウト（追加）し、リクエスト数が減少したらスケールイン（削除）して元の状態に戻ります。
* リダイレクト
  ALBには、ALBに送られてきたリクエストを別のURLにリダイレクトする機能があります。例えば、ユーザーから「http://www.example.com」（HTTP）へ送られたリクエストを「https://www.example.com」（HTTPS）に変換することで、セキュアな通信が可能になります。HTTPのリクエストをHTTPSに変換するには、ALBでHTTPリスナーを作成し、HTTPSへリダイレクトするルールを設定します。
* ELB経由の暗号化通信
  ELB経由でクライアントとターゲット間の通信を暗号化させるには、暗号化する通信の範囲とサーバー証明書（SSL/TLS証明書）の配置によって3つの方法があります。サーバー証明書とは、ユーザーとの通信をHTTPSで暗号化するとともに、ドメイン（ping-t.com など）の使用権を確認してアクセス先のサーバーが本物であるという証明する電子証明書のことです。ELB経由の暗号化通信に利用するサーバー証明書は、AWS Certificate Manager（SSL/TLS証明書を管理するサービス）で管理されている証明書を利用できます。
  * クライアントとELB間の通信を暗号化する
    * ELBにサーバー証明書を導入する
      クライアントとELB間で通信を暗号化し、ELBとターゲット間は平文の通信（暗号化されていない通信）を行う方法です。クライアントとELB間での通信の暗号化・復号をELBが行うため、ターゲットに暗号化・復号による負荷が発生しません。すべてのELBが対応しています。
  * クライアントとターゲット間の通信を暗号化する
    * ELBとターゲットにサーバー証明書を導入する
      クライアントとELB間、ELBとターゲット間で別の暗号化通信を行う方法です。暗号化接続はELBが終端となり、ELBから別の暗号化接続を確立して通信します。ELB、ターゲットに暗号化・復号による負荷がかかりますが、クライアントからターゲットまでの通信すべてを暗号化できます。ALB、CLBが対応しています。
    * ターゲットにサーバー証明書を導入する
      ELBでは暗号化・復号せず、直接クライアントとターゲット間で暗号化通信を行う方法です。ターゲットに暗号化・復号による負荷が発生しますが、ELBによる暗号化・復号の遅延を発生させずに通信全てを暗号できます。NLB、CLBが対応しています。
* SNIを利用したELB経由の暗号化通信
  SNI（Server Name Indication）は、暗号化通信で使用するサーバー証明書をパブリックIPアドレスではなくドメイン名によって判断する技術です。SNIに対応したELBに複数のサーバー証明書を導入すると、ELBが宛先ドメイン名から適切なサーバー証明書を判断してサーバーへ通信を転送します。SNIはALBとNLBが対応しています。
##### Auto Scaling 
* シンプルスケーリング
  1つのメトリクス（CPU使用率などシステムのパフォーマンスに関するデータ）に対する1つのしきい値に基づいて、インスタンスを増減します。
  例：300秒間の平均CPU使用率が50％を超えたら、インスタンスを1台追加する

* ステップスケーリング
  1つのメトリクスに対する複数のしきい値に基づいて、インスタンスの増減を段階的に行います。
  例：300秒間の平均CPU使用率が50％を超えたらインスタンスを1台追加し、90％を超えたら2台追加する

* ターゲット追跡スケーリング
  1つのメトリクスが指定した目標値になるように、インスタンスを増減します。増減するインスタンス数はAWS側で調整されます。
  例：平均CPU使用率を30％に維持する

### コンピューティング
#### Lambda/API Gateway
##### Amazon API Gateway種類
* REST API（RESTful API）
  クライアントからのリクエストに対してレスポンスを返す形式のAPIです。サーバーが扱う情報はURI(URL)で定義されており、クライアントはHTTP（HTTPS）でリクエストを送信することでレスポンスを得ます。データベースの検索など、クライアントからのリクエストに応答するアプリケーションで使われます。
* HTTP API
  REST APIよりも低遅延かつコスト効率を高くする目的で設計されたAPIです。REST APIと同じ形式のAPIですが、APIキャッシュを利用できないなど細かな差異があります。
* WebSocket API
  クライアントとサーバー間でリアルタイムな情報のやり取りを目的とするAPIです。REST APIとは違い、継続的なデータの送受信を行えます。
チャットや株価情報のような常に情報をモニタリングするようなアプリケーションで使われます。なお、WebSocket APIとはサーバー・クライアント間で双方向のセッションを確立できる技術を利用したAPIのことです。通信の状態を管理される「ステートフル」な接続方式です。
##### API キャッシュ
Amazon API Gatewayにはクライアントへ送信したデータを保存する「API キャッシュ」機能があります。REST APIではどのクライアントからでも同一のリクエストであれば同一のレスポンスになります。API キャッシュではクライアントに送ったレスポンスをAPI Gatewayでキャッシュし、再度同一のリクエストを受け取るとキャッシュからデータを返します。API キャッシュから応答を返すことにより、Lambda関数の実行を省略できるのでレスポンス速度が向上します。

#### ECS/Fargate

### ストレージ
#### EBS
HDDのボリュームタイプ（st1、sc1）はEC2インスタンスの起動ボリュームには指定できません。
#### EFS
##### Amazon EFS（Elastic File System）の特徴
* 容量無制限：EFSではデータ量に伴い自動的にスケーリング（拡張・縮小）が行われるため、利用開始にあたり事前に容量を確保する必要はありません。保存したデータ量に応じて課金が発生します。
* 可用性：EFSはリージョン内の複数のAZにまたがってサービスを提供しているため、単独AZの障害にも影響を受けません。またデフォルトでAWS Backupを使ったバックアップが有効になっています。
* 堅牢性：EFSはデフォルトで保管時のデータの暗号化が有効になっています。また、EFSのファイルシステムマウント時にTLS（Transport Layer Security：セキュアな通信を行うプロトコル）を使うこともできるので、転送データを安全に扱えます。
##### パフォーマンスモードとスループットモード
* パフォーマンスモード（EFS作成時に設定）には以下の2つがあります：
  * 汎用パフォーマンスモード ... 一般的な用途向けのモード
  * 最大I/Oパフォーマンスモード ... ビッグデータの解析などの大容量データや、数千台のクライアントの処理向けのモード
* スループットモード（運用中に変更可能）には以下の2つがあります：
  * バーストスループットモード ... ストレージの容量に従ってベースライン性能（基本性能）が設定され、一時的に負荷が高くなった場合はベースライン性能の2倍まで性能向上できる
  * プロビジョンドスループットモード ... ユーザーが予約した（provisioned）性能をAWSが保証してスループットを提供する
#### FSx
##### Amazon FSx For Windowsファイルサーバー
FSx For Windowsファイルサーバーは、SMBプロトコル（※）を介してWindows Server（OS）上に構築されたファイルシステムを提供するフルマネージドのストレージサービスです。
* フルマネージドシステムである
* Windowsサーバーが提供する既存機能を利用できる
##### Amazon FSx For Lustre
LustreとはLinux上で動作するオープンソースのファイルシステムで、主にスーパーコンピューターなどのHPC（High Performance Computing）や機械学習の分野で利用されています。大量のクライアント（ファイルシステムを利用する端末）から、低レイテンシかつ高スループットにファイルアクセスを行う必要のあるシステムで利用されます。
* フルマネージドシステムである
* Amazon S3と連携できる
* POSIXに準拠したファイルシステムである
#### Storage Gateway
AWS Storage Gatewayは、オンプレミス（自社環境）からAWSのストレージサービスへのアクセスを高速かつセキュアに行うことができるサービスです。堅牢性・耐久性に優れたS3をファイル共有ストレージとして利用したり、災害対策を目的としたバックアップやアーカイブを行ったり、あまりアクセスされないデータを自社サーバーからAWSへ移動させるなど、様々なケースで利用することができます。
###### Storage Gatewayのゲートウェイタイプ
|ストレージサービス|ストレージ形式|
|ファイルゲートウェイ|ファイル単位|
|ボリュームゲートウェイ_キャシュー方|ボリューム単位|
|ボリュームゲートウェイ_保管型|ボリューム単位|
|テープゲートウェイ|仮想テープ単位|
* ファイルゲートウェイ
  オンプレミスから、NFSまたはSMBを介してS3バケットへアクセスすることができます。オンプレミスにキャッシュストレージを持つため、高速なデータアクセスが可能です。
* ボリュームゲートウェイ
  S3をiSCSI接続のブロックストレージボリュームとして提供します。iSCSI（Internet Small Computer System Interface）とはコンピュータのストレージを接続するSCSIプロトコルをTCP/IPで実現したもののことで、サーバーはiSCSIで接続されたストレージ（Storage Gatewayの場合はS3）をローカルディスクとして使用します。
  * キャッシュ型（キャッシュボリューム）
    すべてのデータをS3に保存し、高頻度アクセスのデータのみオンプレミスのキャッシュストレージにコピーします。データがキャッシュ上に存在しない場合はS3へアクセスするので遅延が発生しますが、オンプレミスのストレージ容量を抑えることができます。
  * 保管型（ストアドボリューム）
    すべてのデータをオンプレミスのボリュームストレージに保存し、S3に非同期でバックアップを保存します。キャッシュ型とは異なり全データへのアクセス先がオンプレミスになるので、S3へのアクセスによる遅延が発生しません。
* テープゲートウェイ
  物理テープストレージの代替として利用できるサービスです。VTL（Virtual Tape Library：仮想テープライブラリ）に対応したソフトウェアを介して、S3やGlacierにバックアップデータを保存することができます。
#### Snow Family
