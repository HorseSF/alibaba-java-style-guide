# alibaba-java-style-guide
* [前言](README.md)
* [编程规约](c1/README.md)
    * [(一) 命名规约](c1/s1.md)
    * [(二) 常量定义](c1/s2.md)
    * [(三) 格式规约](c1/s3.md)
    * [(四) OOP规约](c1/s4.md)
    * [(五) 集合处理](c1/s5.md)
    * [(六) 并发处理](c1/s6.md)
    * [(七) 控制语句](c1/s7.md)
    * [(八) 注释规约](c1/s8.md)
    * [(九) 其他](c1/s9.md)
* [异常日志](c2/README.md)
    * [(一) 异常处理](c2/s1.md)
    * [(二) 日志处理](c2/s2.md)
* [MySQL规约](c3/README.md)
    * [(一) 建表规约](c3/s1.md)
    * [(二) 索引规约](c3/s2.md)
    * [(三) SQL规约](c3/s3.md)
    * [(四) ORM规约](c3/s4.md)
* [工程规约](c4/README.md)
    * [(一) 应用分层](c4/s1.md)
    * [(二) 二方库规约](c4/s2.md)
    * [(三) 服务器规约](c4/s3.md)
* [安全规约](c5/README.md)

### データベース
#### RDS/Aurora
##### 特徴
* データベースインスタンスとストレージが分離したアーキテクチャ
* 複数のデータコピーと自動修復機能などによるストレージの高い耐障害性
* レプリカインスタンスの自動フェイルオーバーによる高可用性
* 最大64TBまでスケール可能な拡張性
* Aurora Auto Scalingによる負荷の自動調整
* データベースのクローンを高速作成
##### Amazon Aurora Global Database（Aurora グローバルデータベース）
Auroraグローバルデータベースは、Auroraデータベースを複数のリージョンにまたがって運用できるサービスです。例えば、東京リージョンで稼働しているデータベースを大阪リージョンにも配置できるということです。Auroraグローバルデータベースを使用しても、ユーザーは複数のリージョンのデータベースを管理する必要はありません。データはプライマリとして稼働しているメインのリージョンからセカンダリリージョンへレプリケートされます。

#### Redshift
データウェアハウス（DWH：Data WareHouse）とは、複数のシステムからデータを収集・統合・蓄積し、分析に使用するデータベースです。蓄積したデータは、例えば時系列や顧客のデータに基づいて分析され、結果はシステム効率化や経営改善などの意思決定に利用されます。このように、大容量データを分析し経営に役立てることを「BI：Business Intelligence」といい、RedshiftはBIの分野で活用されています。

#### DynamoDB
##### バックアップ方法
* 「オンデマンドバックアップ」は、ユーザーが任意のタイミングで作成するバックアップのことです。マネジメントコンソールまたはAPIを利用して、テーブルの完全なバックアップを作成します。
* 自動的にバックアップを行いたい場合は「ポイントインタイムリカバリ（PITR）」を有効にします。オンデマンドバックアップとは違い、差分バックアップが定期的に自動で取得されます。リカバリ時は、35日前まで遡ることができます。
##### キャパシティ
DynamoDBでは、テーブルに対する書き込み・読み込みの量と利用料金が関係しています。
* オンデマンドモード ... 書き込み・読み込みのリクエスト単位で利用料金がかかる
* プロビジョニングモード ... 1秒間に行う書き込み・読み込みの量で利用料金が異なる

#### ElastiCache
##### データベースエンジン
* Memcached」
  高パフォーマンスを提供する。
データの永続保持やレプリケーション機能はないため、シンプルなキャッシュとしての利用に向いている
* Redis
  高パフォーマンス + 高可用性、機密性を提供する。
自動フェイルオーバー (障害発生時の切替え)やバックアップ・リストア、データ暗号化などを備えている

### マネジメント、ガバナンス
#### CloudWatch
##### 標準メトリクス
* 【EC2】CPU使用率、ディスクの読み取り・書き込み量
* 【S3】バケットサイズ、ファイル（オブジェクト）数
* 【ELB】リクエスト数、リクエストの応答時間
* 【RDS】ストレージの空き容量、秒間の読み取り・書き込み操作の量
##### CloudWatch Logs Insights
2018年に追加された機能で、収集したログのインタラクティブな検索や分析を行うことができます。CloudWatch Logsの管理コンソールでは単語検索によるフィルタリングを行えますが、CloudWatch Logs Insightsではクエリの実行にも対応しており、例えば「特定のアプリケーションが一定期間に出力した"Error"を含むメッセージをカウントする」など柔軟なログ解析が可能です。

#### CloudTrail
##### 複数アカウントのログ保存
企業や組織などにおいて複数のAWSアカウントを管理している場合、それぞれのCloudTrailのログを1つのS3バケットで管理することができます。例えばアカウントA、B、Cの操作ログを監査用のアカウントDに属するバケットに集約することで、監査を容易に行えたり、各アカウントによるログの改ざんを防ぐことができます。
複数アカウントのCloudTrailログを集約する際は、証跡情報の作成時に「ストレージの場所」を既存のS3バケットに指定します。なお指定するS3バケットは、他のアカウントからアクセスが可能になるように事前にバケットポリシーを設定しておく必要があります。

#### Elastic Beanstalk
AWS Elastic Beanstalk は、アプリケーションが動作する定番の構成を提供します。アプリケーションの開発者は、Elastic Beanstalkによって用意されている定番構成の中からアプリケーションの実行環境に適したものを選んで数クリックするだけで、環境（インフラ）を作成することができます。
EC2インスタンスは、OSはもちろん、Webサーバーソフトウェアやアプリケーションの実行環境などがインストール・設定された状態で提供されます。単一インスタンス・複数インスタンス（Multi-AZ）の構成を選択でき、関連する各種AWSサービス（ELBやS3、Auto Scalingグループなど）も設定済みのため、開発者はアプリケーションをアップロードするだけでデプロイ（実行環境への展開）を行うことができます。

#### CloudFormation
##### スタックセット
AWS CloudFormationで作成したテンプレートを基に、複数のAWSアカウントで、または複数のリージョンでスタックを構築したい場合には「スタックセット（StackSets）」を利用します。管理者アカウントで作成したテンプレートを利用して、ターゲットアカウント（プロビジョニングを行うアカウント）とプロビジョニングを行うリージョンを指定することで、一度の操作で複数の同じ環境を構築できます。
テスト環境を複数構築したい場合や、新たにアカウントを払い出す際に下準備となる操作（IAMやセキュリティグループの設定など）をスタックセットとして作成しておく、といった利用ができます。
#### Trusted Advisor

### セキュリティ、アイデンティティ、コンプライアンス
#### WAF/Shield
##### AWS WAF
AWS WAF（Web Application Firewall）は、脆弱性を突く攻撃（クロスサイトスクリプティングやSQLインジェクションなど）から、Webアプリケーションを保護するサービスです。「Web ACL」というアクセスコントロールリストで、IPアドレス、HTTPヘッダー、HTTP本文、URI文字列などに対してフィルタリングの条件を設定できます。また、Web ACLには接続元のIPアドレスから国別にアクセスを制限できる機能もあります。AWS WAFは、Amazon CloudFront、Application Load Balancer、Amazon API Gatewayなどに割り当てて利用します。
##### AWS Shield
AWS Shieldは、DDoS攻撃からの保護に特化したサービスです。すべてのAWSユーザーが無償で利用できる「AWS Shield Standard」と、有償版の「AWS Shield Advanced」があります。EC2インスタンス、Elastic Load Balancing（ELB）、Amazon CloudFrontなどを標的としたDDoS攻撃に対して、高度な保護サービスを利用できます。

#### KMS/CloudHSM
##### KMS 暗号化の仕組み
AWS KMSでは「KMSキー」「データキー」と呼ばれる2種類の鍵を使用してデータの暗号化および復号を行います。このように二段階で鍵を保護する方式を「エンベロープ暗号化（Envelope Encryption）」といいます。KMSでは、KMSキーとデータキーという2段階で鍵を管理することによってセキュリティの向上を図っています。
「KMSキー」はデータキーを暗号化する際に使用し、「データキー」はデータを暗号化する際に使用します。
データキーは通常、暗号化を行う対象のサービスごとに作成します。これにより、1つのデータキーが漏洩したとしても他のデータキーで暗号化されたサービスへは影響しません。また、データキーをKMSキーで暗号化することによって、運用時に頻繁に使用されるデータキーを保護します。
##### AWS CloudHSM
AWS CloudHSMでは、専用のハードウェアデバイスを用いて暗号化鍵を生成・管理します。貸し出されるハードウェアは世界的な暗号化ハードウェアの規格（FIPS 140-2 のレベル 3）で認証済みのため、信頼性の高さが強みです。
なお、「CloudHSM」のHSM（Hardware Security Module）とは、データセキュリティを高めるための暗号鍵を保護しつつ運用するデバイスのことです。
KMSでは鍵の管理はAWS側で行われるのに対して（フルマネージド）、CloudHSMでは鍵の生成や保管・削除などのライフサイクル管理はユーザー自身が行います。運用面においても、CloudHSMは他のAWSユーザーと分離するためにAmazon VPC内にプロビジョニングする必要があるなど、KMSよりもセキュアな運用が求められます。
なお、CloudHSMでは専用のハードウェアを使用する分、KMSと比べると利用料金が高価に設定されています。
法令や規制等の要件で、認定を受けたハードウェアで暗号化鍵を管理する必要があるようなケースでは、CloudHSMを使用します。
